<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Quiz Escolar üéì</title>
<style>
  :root{
    --bg:#000;
    --white:#fff;
    --safe-top:env(safe-area-inset-top,0px);
    --safe-bottom:env(safe-area-inset-bottom,0px);
  }

  /* Reset / base */
  html,body{height:100%; width:100%; margin:0; padding:0; background:var(--bg); color:var(--white); -webkit-text-size-adjust:100%;}
  body{font-family:"Comic Sans MS", Arial, Helvetica, sans-serif; overflow:hidden; padding-top:var(--safe-top); padding-bottom:var(--safe-bottom);}

  /* TELA INICIAL e PARTICULAS
     - tela-inicial tem o background (imagem)
     - canvas fica sobre a imagem, mas abaixo dos controles (z-index)
  */
  #tela-inicial{
    position:fixed; inset:0;
    background-image:url('https://uploads.onecompiler.io/444jywmud/444jyqxv3/inico%20de%20tela.png');
    background-size:cover; background-position:center;
    display:flex; align-items:center; justify-content:center;
    transition:opacity .5s ease;
    z-index:0; /* background layer */
  }
  /* canvas deve cobrir toda a √°rea, mas n√£o esconder outros elementos */
  #particles{ position:fixed; inset:0; pointer-events:none; z-index:1; }

  /* bot√£o START deve ficar acima do canvas (z-index maior) */
  #start-btn{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:calc(18px + var(--safe-bottom));
    font-size:clamp(16px,4vw,20px);
    font-weight:700;
    color:var(--white);
    background:rgba(0,0,0,0.6);
    border:2px solid rgba(255,255,255,0.12);
    padding:12px 28px;
    border-radius:14px;
    z-index:20;
    min-height:56px;
    display:flex; align-items:center; gap:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.6);
  }

  /* QUIZ container: inicialmente escondido */
  .quiz-container{
    display:none; position:fixed; inset:0; padding:12px; align-items:center; justify-content:center;
    background-image:url('https://uploads.onecompiler.io/444jywmud/444jyqxv3/sala%20de%20aulas.png');
    background-size:cover; background-position:center; transition:opacity .35s ease;
    z-index:5;
  }

  .area-jogo{ width:100%; max-width:1100px; display:flex; gap:18px; align-items:center; justify-content:center; padding-bottom:calc(32px + var(--safe-bottom)); margin:0 auto; }

  .professor{
    width:min(38vw,260px); min-width:140px; height:auto;
    aspect-ratio:3/4; background-size:contain; background-repeat:no-repeat; background-position:bottom center;
    animation: idle 3s ease-in-out infinite; display:none; flex-shrink:0; z-index:6;
  }

  .quadro-fundo{
    flex:1; min-width:220px;
    background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.65));
    border-radius:18px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,0.6);
    display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:8px;
    max-height:calc(100vh - 120px); overflow:auto;
  }
  #question{ font-size:clamp(16px,4vw,22px); text-align:center; margin:6px 6px 14px; line-height:1.3; word-break:break-word; }
  #answers{ display:flex; flex-direction:column; gap:12px; width:100%; align-items:center; padding-bottom:8px; }
  #answers button{ width:92%; max-width:560px; padding:14px 18px; font-size:16px; border-radius:12px; border:2px solid rgba(255,255,255,0.12); background:transparent; color:var(--white); cursor:pointer; min-height:48px; display:flex; align-items:center; justify-content:center; transition:transform .15s ease, background .15s ease; }
  #answers button:hover{ background: rgba(255,255,255,0.06); transform:translateY(-2px); }

  .feedback{ font-size:18px; margin-top:8px; text-shadow:0 1px 4px rgba(0,0,0,0.8); }
  .feedback.correct{ color:#8ef5c9 }
  .feedback.wrong{ color:#ffb3b3 }

  /* professor login / editor */
  #professor-login, #cadastro-perguntas{ position:fixed; left:50%; transform:translateX(-50%); z-index:30; background:rgba(0,0,0,0.7); padding:12px; border-radius:14px; color:var(--white); width:calc(100% - 40px); max-width:760px; box-shadow:0 10px 30px rgba(0,0,0,0.6); }
  #professor-login input{ padding:10px 12px; border-radius:10px; border:none; width:60%; max-width:360px; margin-right:8px; }
  #cadastro-perguntas{ top:12px; display:none; max-height:60vh; overflow:auto; }
  #btn-sair-edicao{ position:fixed; top:calc(8px + var(--safe-top)); right:12px; z-index:40; display:none; background:#ff5252; color:white; border:none; padding:10px 12px; border-radius:10px; font-weight:700; }

  /* tela final overlay gen√©rica (criamos dinamicamente) */

  /* anima√ß√µes */
  @keyframes idle{0%{transform:translateY(0)}50%{transform:translateY(-4px)}100%{transform:translateY(0)}}
  @keyframes jump{0%{transform:translateY(0)}50%{transform:translateY(-12px)}100%{transform:translateY(0)}}
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}

  /* Mobile adjustments (incl. iPhone 13 size) */
  @media (max-width:430px){
    .area-jogo{ flex-direction:column; gap:14px; padding:12px; }
    .professor{ width:56vw; }
    .quadro-fundo{ width:95%; padding:12px; max-height:calc(100vh - 180px); }
    #question{ font-size:18px; }
    #answers button{ font-size:16px; padding:12px; }
    #start-btn{ font-size:20px; padding:12px 22px; bottom:calc(16px + var(--safe-bottom)); }
  }

</style>
</head>
<body>

<!-- Tela Inicial + particles -->
<div id="tela-inicial">
  <canvas id="particles"></canvas>
</div>

<button id="start-btn" aria-label="Iniciar Quiz">START</button>

<!-- Login professor -->
<div id="professor-login" role="dialog" aria-label="Acesso do professor" style="top:12px;">
  <input id="senha-professor" type="password" placeholder="Senha do professor" aria-label="Senha do professor" />
  <button onclick="entrarProfessor()">Entrar</button>
  <small style="display:block;opacity:.7;margin-top:6px">Somente professor pode editar. Toque START para os alunos iniciarem.</small>
</div>

<!-- Editor perguntas (vis√≠vel s√≥ ao professor) -->
<div id="cadastro-perguntas">
  <h3>Adicionar / Editar Pergunta</h3>
  <input id="nova-pergunta" type="text" placeholder="Digite a pergunta" />
  <div style="display:flex;gap:8px">
    <input id="alt1" type="text" placeholder="Alternativa 1" />
    <input id="alt2" type="text" placeholder="Alternativa 2" />
  </div>
  <input id="alt3" type="text" placeholder="Alternativa 3" />
  <select id="certa" aria-label="Alternativa correta">
    <option value="0">Alternativa 1</option>
    <option value="1">Alternativa 2</option>
    <option value="2">Alternativa 3</option>
  </select>
  <div style="display:flex;gap:8px;margin-top:8px">
    <button onclick="adicionarPergunta()">Adicionar Pergunta</button>
  </div>
  <div id="lista-perguntas" style="margin-top:10px"></div>
</div>

<!-- Bot√£o Sair edi√ß√£o -->
<button id="btn-sair-edicao" onclick="sairEdicao()">SAIR</button>

<!-- Quiz -->
<div class="quiz-container" id="quiz-container" role="application" aria-label="Quiz">
  <div class="area-jogo">
    <div class="professor" id="professor" aria-hidden="true"></div>
    <div class="quadro-fundo" role="region" aria-live="polite">
      <div id="question" aria-label="Pergunta"></div>
      <div id="answers" role="list"></div>
      <div id="feedback" class="feedback" aria-atomic="true"></div>
    </div>
  </div>
</div>

<script>
/* ---------------- PARTICULAS (leve) ---------------- */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas(); addEventListener('resize', resizeCanvas);
let mouse={x:null,y:null};
addEventListener('touchmove', e=>{ const t=e.touches[0]; mouse.x=t.clientX; mouse.y=t.clientY },{passive:true});
addEventListener('mousemove', e=>{ mouse.x=e.clientX; mouse.y=e.clientY });

class Particle{ constructor(){ this.x=Math.random()*canvas.width; this.y=Math.random()*canvas.height; this.size=Math.random()*1.8+0.8; this.base=this.size; this.vx=(Math.random()-0.5)*0.4; this.vy=(Math.random()-0.5)*0.4; this.o=Math.random()*0.6+0.2 } update(){ this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>canvas.width)this.vx*=-1; if(this.y<0||this.y>canvas.height)this.vy*=-1; if(mouse.x&&mouse.y){ const dx=mouse.x-this.x, dy=mouse.y-this.y, d=Math.sqrt(dx*dx+dy*dy); if(d<80){ this.size=this.base+(80-d)/40; this.o=Math.min(1, this.o+(80-d)/200)} else{ this.size=this.base; this.o=this.o } } } draw(){ ctx.beginPath(); ctx.fillStyle='rgba(255,255,150,'+this.o+')'; ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill(); } }
const parts=[]; for(let i=0;i<60;i++) parts.push(new Particle());
(function loop(){ ctx.clearRect(0,0,canvas.width,canvas.height); parts.forEach(p=>{p.update();p.draw()}); requestAnimationFrame(loop) })();

/* ---------------- APP LOGIC (mantive sua l√≥gica) ---------------- */
let imgFrames = [
  "https://uploads.onecompiler.io/444jywmud/444jyqxv3/professora%20frame%201.png",
  "https://uploads.onecompiler.io/444jywmud/444jyqxv3/professora%20frame%202.png",
  "https://uploads.onecompiler.io/444jywmud/444jyqxv3/professora%20frame%203.png"
];
let imgCerta = "https://uploads.onecompiler.io/444jywmud/444jyqxv3/joinhaa.png";
let imgErrada = "https://uploads.onecompiler.io/444jywmud/444jyqxv3/errada.png";

let perguntas = [], indice=0, pontuacao=0, escreverVelocidade=60;
const professorEl = document.getElementById('professor');
const feedbackEl = document.getElementById('feedback');
const quizContainer = document.getElementById('quiz-container');
const telaInicial = document.getElementById('tela-inicial');
const startBtn = document.getElementById('start-btn');
const btnSair = document.getElementById('btn-sair-edicao');
const listaPerguntasEl = document.getElementById('lista-perguntas');

/* Load from localStorage */
function salvarPerguntas(){ try{ localStorage.setItem('perguntasQuiz', JSON.stringify(perguntas)); }catch(e){ console.warn(e) } }
function carregarPerguntas(){ const d = localStorage.getItem('perguntasQuiz'); if(d){ try{ perguntas = JSON.parse(d) || []; atualizarCadastro(); }catch(e){ console.warn('JSON inv√°lido') } } }
carregarPerguntas();

/* Editor / Professor */
function entrarProfessor(){
  const senha = document.getElementById('senha-professor').value.trim();
  // Mantive valida√ß√£o mas sem mostrar a senha como exemplo
  if(senha === "2702"){
    document.getElementById('cadastro-perguntas').style.display = 'block';
    btnSair.style.display = 'block';
    document.getElementById('professor-login').style.display = 'none';
    atualizarCadastro();
    professorEl.style.display = 'block';
    professorEl.style.backgroundImage = `url(${imgFrames[0]})`;
  } else {
    alert('Senha incorreta');
  }
}
function sairEdicao(){
  document.getElementById('cadastro-perguntas').style.display = 'none';
  document.getElementById('professor-login').style.display = 'block';
  document.getElementById('senha-professor').value = '';
  btnSair.style.display = 'none';
}

/* Add / Edit / Remove */
function adicionarPergunta(){
  const pergunta = document.getElementById('nova-pergunta').value.trim();
  const op1 = document.getElementById('alt1').value.trim();
  const op2 = document.getElementById('alt2').value.trim();
  const op3 = document.getElementById('alt3').value.trim();
  const certa = parseInt(document.getElementById('certa').value,10);
  if(!pergunta || !op1 || !op2 || !op3) { alert('Preencha todos os campos'); return; }
  perguntas.push({pergunta, opcoes:[op1,op2,op3], certa});
  document.getElementById('nova-pergunta').value=''; document.getElementById('alt1').value=''; document.getElementById('alt2').value=''; document.getElementById('alt3').value='';
  salvarPerguntas(); atualizarCadastro();
}

function atualizarCadastro(){
  listaPerguntasEl.innerHTML = '';
  perguntas.forEach((p,i)=>{
    const item = document.createElement('div');
    item.style.display='flex'; item.style.justifyContent='space-between'; item.style.alignItems='center';
    item.style.padding='8px'; item.style.borderTop='1px dashed rgba(255,255,255,0.06)';
    const left = document.createElement('div');
    left.innerHTML = `<strong>${i+1}.</strong> ${p.pergunta}`;
    const right = document.createElement('div');
    right.style.display='flex'; right.style.gap='8px';
    const edit = document.createElement('button'); edit.textContent='Editar'; edit.style.padding='6px 8px'; edit.onclick = ()=>{ 
      document.getElementById('nova-pergunta').value = p.pergunta;
      document.getElementById('alt1').value = p.opcoes[0];
      document.getElementById('alt2').value = p.opcoes[1];
      document.getElementById('alt3').value = p.opcoes[2];
      document.getElementById('certa').value = p.certa;
      perguntas.splice(i,1);
      salvarPerguntas(); atualizarCadastro();
    };
    const del = document.createElement('button'); del.textContent='Remover'; del.style.padding='6px 8px'; del.onclick = ()=>{
      if(confirm('Remover pergunta?')){ perguntas.splice(i,1); salvarPerguntas(); atualizarCadastro(); }
    };
    right.appendChild(edit); right.appendChild(del);
    item.appendChild(left); item.appendChild(right);
    listaPerguntasEl.appendChild(item);
  });
}

/* START quiz */
startBtn.addEventListener('click', ()=>{
  if(perguntas.length===0){ alert('Adicione pelo menos uma pergunta antes de iniciar.'); return; }
  telaInicial.style.opacity = 0;
  startBtn.style.opacity = 0;
  setTimeout(()=>{
    telaInicial.style.display='none';
    document.getElementById('professor-login').style.display='none';
    document.getElementById('cadastro-perguntas').style.display='none';
    btnSair.style.display='none';
    quizContainer.style.display='flex';
    setTimeout(()=>quizContainer.style.opacity=1,50);
    professorEl.style.display = 'block';
    professorEl.style.backgroundImage = `url(${imgFrames[0]})`;
    indice = 0; pontuacao = 0;
    mostrarPergunta();
  }, 450);
});

/* writing animation */
let escreverIntervalo = null;
function escreverNoQuadro(el, texto){
  el.textContent = '';
  if(escreverIntervalo) clearInterval(escreverIntervalo);
  return new Promise(resolve=>{
    let i=0, frame=0;
    escreverIntervalo = setInterval(()=>{
      el.textContent += texto[i] || '';
      professorEl.style.backgroundImage = `url(${imgFrames[frame]})`;
      frame = (frame+1)%imgFrames.length;
      i++;
      if(i >= texto.length){ clearInterval(escreverIntervalo); escreverIntervalo=null; professorEl.style.backgroundImage = `url(${imgFrames[0]})`; resolve(); }
    }, escreverVelocidade);
  });
}

async function mostrarPergunta(){
  if(!perguntas[indice]) { mostrarFim(); return; }
  const q = perguntas[indice];
  const respostasDiv = document.getElementById('answers'); respostasDiv.innerHTML = ''; feedbackEl.textContent='';
  await escreverNoQuadro(document.getElementById('question'), q.pergunta);
  q.opcoes.forEach((opt, i)=>{
    const b = document.createElement('button');
    b.textContent = opt;
    b.setAttribute('role','listitem');
    b.onclick = ()=> checkAnswer(i === q.certa, b);
    respostasDiv.appendChild(b);
  });
}

/* resposta */
function checkAnswer(certa, btnEl){
  professorEl.style.animation = '';
  if(certa){
    pontuacao++; feedbackEl.textContent = 'Muito bem!'; feedbackEl.className = 'feedback correct';
    professorEl.style.backgroundImage = `url(${imgCerta})`; professorEl.style.animation = 'jump 0.6s';
    setTimeout(()=>{ professorEl.style.animation = 'idle 3s ease-in-out infinite'; professorEl.style.backgroundImage = `url(${imgFrames[0]})`; indice++; if(indice < perguntas.length) mostrarPergunta(); else mostrarFim(); }, 600);
  } else {
    feedbackEl.textContent = 'Tente novamente!'; feedbackEl.className = 'feedback wrong';
    professorEl.style.backgroundImage = `url(${imgErrada})`; professorEl.style.animation = 'shake 0.5s';
    setTimeout(()=>{ professorEl.style.animation = 'idle 3s ease-in-out infinite'; professorEl.style.backgroundImage = `url(${imgFrames[0]})`; indice++; if(indice < perguntas.length) mostrarPergunta(); else mostrarFim(); }, 500);
  }
}

/* fim e reset */
function mostrarFim(){
  // cria overlay bonito e centralizado
  const fimDiv = document.createElement('div');
  fimDiv.id = 'tela-fim';
  fimDiv.style.position = 'fixed';
  fimDiv.style.inset = '0';
  fimDiv.style.display = 'flex';
  fimDiv.style.flexDirection = 'column';
  fimDiv.style.justifyContent = 'center';
  fimDiv.style.alignItems = 'center';
  fimDiv.style.background = 'linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.9))';
  fimDiv.style.color = 'white';
  fimDiv.style.zIndex = 80;
  fimDiv.style.padding = '20px';
  if(pontuacao === perguntas.length){
    const txt = document.createElement('div');
    txt.innerHTML = `Parab√©ns! Voc√™ desbloqueou: <b>Nota 10</b>`;
    txt.style.fontSize = '20px'; txt.style.textAlign = 'center'; txt.style.marginBottom = '12px';
    fimDiv.appendChild(txt);
    const img = document.createElement('img');
    img.src = 'https://uploads.onecompiler.io/444jywmud/444jyqxv3/joinhaa.png';
    img.style.width = '180px'; img.style.borderRadius = '12px'; img.style.marginBottom = '12px';
    fimDiv.appendChild(img);
  } else {
    const txt = document.createElement('div');
    txt.innerHTML = `Fim do Quiz! Voc√™ acertou ${pontuacao} de ${perguntas.length}.`;
    txt.style.fontSize='20px'; txt.style.textAlign = 'center'; txt.style.marginBottom = '12px';
    fimDiv.appendChild(txt);
  }
  const btn = document.createElement('button');
  btn.textContent = 'Voltar';
  btn.style.padding = '12px 18px';
  btn.style.marginTop = '12px';
  btn.onclick = ()=>{ fimDiv.remove(); resetarJogo(); };
  fimDiv.appendChild(btn);
  document.body.appendChild(fimDiv);
  // esconder quiz
  quizContainer.style.display = 'none';
}

/* reset */
function resetarJogo(){
  telaInicial.style.display = 'flex';
  telaInicial.style.opacity = 1;
  startBtn.style.opacity = 1;
  indice = 0; pontuacao = 0;
  quizContainer.style.display = 'none';
  document.getElementById('question').textContent=''; document.getElementById('answers').innerHTML=''; feedbackEl.textContent='';
  const fimExist = document.getElementById('tela-fim'); if(fimExist) fimExist.remove();
}

/* ESC para sair do modo professor */
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') sairEdicao(); });

/* Accessibility: focus start button for easier keyboard users */
if(startBtn) startBtn.focus();
</script>

</body>
</html>
